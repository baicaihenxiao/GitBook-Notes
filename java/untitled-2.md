# Apache 架构师的 30 条设计原则！

[https://mp.weixin.qq.com/s/5cUnBHYIGFFwc20TKes9fg](https://mp.weixin.qq.com/s/5cUnBHYIGFFwc20TKes9fg)

点击上方“芋道源码”，选择“[设为星标](http://mp.weixin.qq.com/s?\_\_biz=MzUzMTA2NTU2Ng==\&mid=2247486188\&idx=3\&sn=f160d91ea23e5113e6077c500a2e30c4\&chksm=fa49755dcd3efc4bf4f566fbbbf74c191d0b79f2d3222fd211bc52d80b5ef127f52b1158ed71\&scene=21#wechat\_redirect)”

做积极的人，而不是积极废人！

源码精品专栏&#x20;

* [原创 | Java 2020 超神之路，很肝\~](http://mp.weixin.qq.com/s?\_\_biz=MzUzMTA2NTU2Ng==\&mid=2247487551\&idx=1\&sn=18f64ba49f3f0f9d8be9d1fdef8857d9\&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8\&scene=21#wechat\_redirect)\

* [中文详细注释的开源项目](http://mp.weixin.qq.com/s?\_\_biz=MzUzMTA2NTU2Ng==\&mid=2247486264\&idx=1\&sn=475ac3f1ef253a33daacf50477203c80\&chksm=fa497489cd3efd9f7298f5da6aad0c443ae15f398436aff57cb2b734d6689e62ab43ae7857ac\&scene=21#wechat\_redirect)\

* [RPC 框架 Dubbo 源码解析](https://mp.weixin.qq.com/s?\_\_biz=MzUzMTA2NTU2Ng==\&mid=2247484647\&idx=1\&sn=9eb7e47d06faca20d530c70eec3b8d5c\&chksm=fa497b56cd3ef2408f807e66e0903a5d16fbed149ef7374021302901d6e0260ad717d903e8d4\&scene=21#wechat\_redirect)
* [网络应用框架 Netty 源码解析](https://mp.weixin.qq.com/s?\_\_biz=MzUzMTA2NTU2Ng==\&mid=2247485054\&idx=2\&sn=9f3b85f7b8454634da6c5c2ded9b4dba\&chksm=fa4979cfcd3ef0d9d2dd92d8d1bd8f1553abc6e2095a5d743e0b2c2afe4955ea2bbbd7a4b79d\&token=55862109\&lang=zh\_CN\&scene=21#wechat\_redirect)\

* [消息中间件 RocketMQ 源码解析](http://mp.weixin.qq.com/s?\_\_biz=MzUzMTA2NTU2Ng==\&mid=2247486256\&idx=1\&sn=81daccd3fcd2953456c917630636fb26\&chksm=fa497481cd3efd97d9239f5eab060e49dea9876a6046eadba0effb878d2fb51f3ba5733e4c0b\&scene=21#wechat\_redirect)\

* [数据库中间件 Sharding-JDBC 和 MyCAT 源码解析](http://mp.weixin.qq.com/s?\_\_biz=MzUzMTA2NTU2Ng==\&mid=2247486257\&idx=1\&sn=4d3c9c675f8833157641a2e0b48e498c\&chksm=fa497480cd3efd96fe17975b0b8b141e87fd0a62673e6a30b501460de80b3eb997056f09de08\&scene=21#wechat\_redirect)
* [作业调度中间件 Elastic-Job 源码解析](http://mp.weixin.qq.com/s?\_\_biz=MzUzMTA2NTU2Ng==\&mid=2247486258\&idx=1\&sn=ae5665ae9c3002b53f87cab44948a096\&chksm=fa497483cd3efd950514da5a37160e7fd07f0a96f39265cf7ba3721985e5aadbdcbe7aafc34a\&scene=21#wechat\_redirect)
* [分布式事务中间件 TCC-Transaction 源码解析](http://mp.weixin.qq.com/s?\_\_biz=MzUzMTA2NTU2Ng==\&mid=2247486259\&idx=1\&sn=b023cf3dbf97e5da59db2f4ee632f5a6\&chksm=fa497482cd3efd9402d71469f71863f71a6998b27e12ca2e00446b8178d79dcef0721d8e570a\&scene=21#wechat\_redirect)
* [Eureka 和 Hystrix 源码解析](http://mp.weixin.qq.com/s?\_\_biz=MzUzMTA2NTU2Ng==\&mid=2247486260\&idx=1\&sn=8f14c0c191d6f8df6eb34202f4ad9708\&chksm=fa497485cd3efd93937143a648bc1b530bc7d1f6f8ad4bf2ec112ffe34dee80b474605c22db0\&scene=21#wechat\_redirect)
* [Java 并发源码](http://mp.weixin.qq.com/s?\_\_biz=MzUzMTA2NTU2Ng==\&mid=2247486261\&idx=1\&sn=bd69f26aadfc826f6313ffbb95e44ee5\&chksm=fa497484cd3efd92352d6fb3d05ccbaebca2fafed6f18edbe5be70c99ba088db5c8a7a8080c1\&scene=21#wechat\_redirect)

来源：Srinath

ImportSource

* 基本原则
* 功能选择
* 服务端设计和并发
* 分布式系统
* 用户体验
* 艰难的问题
* 总结

本文作者叫 Srinath，是一位科学家，软件架构师，也是一名在分布式系统上工作的程序员。他是 Apache Axis2 项目的联合创始人，也是 Apache Software 基金会的成员。他是WSO2流处理器（wso2.com/analytics）的联席架构师。Srinath 撰写了两本关于 MapReduce 和许多技术文章的书。他获得了博士学位。来自美国印第安纳大学。

Srinath 通过不懈的努力最终总结出了30条架构原则，他主张架构师的角色应该由开发团队本身去扮演，而不是专门有个架构师团队或部门。Srinath 认为架构师应该扮演的角色是一个引导者，讨论发起者，花草修建者，而不是定义者和构建者。Srinath 为了解决团队内部的架构纷争和抉择，制定了以下30条原则，这些原则被成员们广泛认可，也成为了新手架构师的学习途径。

## 基本原则

**原则1**：KISS(Keep it simple,sutpid) 和保持每件事情都尽可能的简单。用最简单的解决方案来解决问题。

**原则2**：YAGNI(You aren’t gonna need it)-不要去搞一些不需要的东西，需要的时候再搞吧。

（小编点评：speculative development的例子可谓俯拾皆是。程序员们对自己说：“我肯定以后会需要这项额外的功能，所以现在就提前把它实现了吧”。其实这是最考验功力的地方，不能闭门YY需要的功能，架构上又要洞察趋势。）

**原则3**：爬，走，跑。换句话说就是先保证跑通，然后再优化变得更好，然后继续优化让其变得伟大。迭代着去做事情，敏捷开发的思路。对于每个功能点，创建里程碑（最大两周），然后去迭代。

（小编点评：快速反馈，一个“拍脑袋的里程碑”也好过没有里程碑...）

**原则4**：创建稳定、高质量的产品的唯一方法就是自动化测试。所有的都可以自动化，当你设计时，不妨想想这一点。

（小编点评：一切自动化也要考虑ROI，比如对于特别易变的页面层...）

**原则5**：时刻要想投入产出比（ROI）。就是划得来不。

**原则6**：了解你的用户，然后基于此来平衡你需要做哪些事情。不要花了几个月时间做了一个devops用户界面，最后你发现那些人只喜欢命令行。此原则是原则5的一个具体表现。

**原则7**：设计和测试一个功能得尽可能的独立。当你做设计时，应该想想这一条。从长远来看这能给你解决很多问题，否则你的功能只能等待系统其他所有的功能都就绪了才能测试，这显然很不好。有了这个原则， 你的版本将会更加的顺畅。

**原则8**：不要搞花哨的。我们都喜欢高端炫酷的设计。最后我们搞了很多功能和解决方案到我们的架构中，然后这些东西根本不会被用到。

（小编点评：老板喜欢ppt？）

## 功能选择

**原则9**：不可能预测到用户将会如何使用我们的产品。所以要拥抱MVP（Minimal Viable Product），最小可运行版本。这个观点主要思想就是你挑几个很少的使用场景，然后把它搞出来，然后发布上线让用户使用，然后基于体验和用户反馈再决定下一步要做什么。

**原则10**：尽可能的做较少的功能。当有疑问的时候，就不要去做，甚至干掉。很多功能从来不会被使用。最多留个扩展点就够了。

（小编点评：产品经理可能是听不进去的，最好采取数据度量说话...）

**原则11**：等到有人提出再说（除非是影响核心流程，否则就等到需要的时候再去做）。

**原则12**：有时候你要有勇气和客户说不。这时候你需要找到一个更好的解决方案来去解决。记住亨利福特曾经说过的 ：”如果我问人们他们需要什么，他们会说我需要一匹速度更快的马”。记住：你是那个专家，你要去引导和领导。要去做正确的事情，而不是流行的事情。最终用户会感谢你为他们提供了汽车。

## 服务端设计和并发

**原则13**：要知道一个server是如何运行的，从硬件到操作系统，直到编程语言。优化IO调用的数量是你通往最好架构的首选之路。

**原则14**：要了解Amdhal同步定律。在线程之间共享可变数据会让你的程序变慢。只在必要的时候才去使用并发的数据结构，只在必须使用同步（synchronization）的时候才去使用同步。如果要用锁，也要确保尽可能少的时间去hold住锁。如果要在加锁后做一些事情，要确保自己在锁内会做哪些事情。

**原则15**：如果你的设计是一个无阻塞且事件驱动的架构，那么千万不要阻塞线程或者在这些线程中做一些IO操作，如果你做了，你的系统会慢的像骡子一样。

## 分布式系统

**原则16**：无状态的系统的是可扩展的和直接的。任何时候都要考虑这一点，不要搞个不可扩展的，有状态的东东出来，这是起码的。

**原则17**：保证消息只被传递一次，不管失败，这很难，除非你要在客户端和服务端都做控制。试着让你的系统更轻便（使用原则18）。你要知道大部分的承诺exactly-once-delivery的系统都是做了精简的。

**原则18**：实现一个操作尽可能的幂等。这样的话就比较好恢复，而且你还处于至少一次传递（at least once delivery）的状态。

**原则19**：知道CAP理论。可扩展的事务（分布式事务）是很难的。如果可能的的话，尽可能的使用补偿机制。RDBMS事务是无法扩展的。

（小编点评：new SQL了解一下。。。）

**原则20**：分布式一致性无法扩展，也无法进行组通信，也无法进行集群范围内的可靠通信。理想情况下最大的节点限制为8个节点。

**原则21**：在分布式系统中，你永远无法避免延迟和失败。

（小编点评：嗯，对，面向fail 设计。但是你的考虑你的用户，你的服务提供SLA。是真的需要7_24_365吗？）

## 用户体验

**原则22**：要了解你的用户和清楚他们的目标。他们是新手、专家还是偶然的用户？他们了解计算机科学的程度。极客喜欢扩展点，开发者喜欢示例和脚本，而普通人则喜欢UI。

**原则23**：最好的产品是不需要产品手册的。

**原则24**：当你无法在两个选择中做决定的时候，请不要直接把这个问题通过提供配置选项的方式传递给用户。这样只能让用户更加的发懵。如果连你这个专家都无法选择的情况下，交给一个比你了解的还少的人这样合适吗？最好的做法的是每次都找到一个可行的选项；次好的做法是自动的给出选项，第三好的做法是增加一个配置参数，然后设置一个合理的默认值。

**原则25**：总是要为配置设置一个合理的默认值。

**原则26**：设计不良的配置会造成一些困扰。应该总是为配置提供一些示例值。

**原则27**：配置值必须是用户能够理解和直接填写的。比如：不能让用户填写最大缓存条目的数量，而是应该让用户填写可被用于缓存的最大内存。

**原则28**：如果输入了未知的配置要抛出错误。永远不要悄悄的忽略。悄悄的忽略配置错误往往是找bug花了数小时的罪魁祸首。

## 艰难的问题

**原则29**：梦想着新的编程语言就会变得简单和明了，但往往要想真正掌握会很难。不要轻易的去换编程语言。

（小编点评：“技术极客”是听不进去的，不如把“个人修炼”和“项目采用”分开看待...）

**原则30**：复杂的拖拉拽的界面是艰难的，不要去尝试这样的效果，除非你准备好了10人年的团队。

（小编点评：我一直不太相信整体性的代码生成，比如MDA，或者拖拉拽建模代替写代码...如果说有成功的，或者是在比较狭小的领域）

最后，说一个我的感受。在一个理想的世界里，一个平台应该是有多个正交组件组成-每个组件都负责一个方面（比如，security，messaging，registry，mdidation，analytics）。好像一个系统构建成这样才是完美的。但不幸的是，现实中我们很难达到这样的状态。因为在项目初始状态时，很多事情是不确定的，你无法做到这样的独立性，现在我更倾向于在开始的时候适当的重复是必要的，当你尝试铲除他们的时候，你会发现引入了新的复杂性，分布本身就意味着复杂。有时候治愈的过程要比疾病本身更加的糟糕。

（小编点评：不同阶段采用不同的做法，照抄往往会东施效颦）

## 总结

作为一个架构师，应该像园丁一般，更多的是修剪花草，除草而不是去定义和构建，你应该策划而不是指挥，你应该去修剪而不是去定义，应该是讨论而不是贴标签。虽然在短期内可能会觉得也没什么，但从长远看，指导团队找到自己的方式会带来好处。如果你稍不留神，就很容易让架构成为一个空洞的词汇。比如设计者会说他的架构是错误的，但不知道为什么是错误的。一个避免这种情况的好办法就是有一个原则列表，这个原则列表是被广泛接受的，这个列表是人们讨论问题的锚点，也是新手架构师学习的路径。

欢迎加入我的知识星球，一起探讨架构，交流源码。加入方式，**长按下方二维码噢**：\


已在知识星球更新源码解析如下：\


最近更新《芋道 SpringBoot 2.X 入门》系列，已经 20 余篇，覆盖了 MyBatis、Redis、MongoDB、ES、分库分表、读写分离、SpringMVC、Webflux、权限、WebSocket、Dubbo、RabbitMQ、RocketMQ、Kafka、性能测试等等内容。\


提供近 3W 行代码的 SpringBoot 示例，以及超 4W 行代码的电商微服务项目。

获取方式：点“**在看**”，关注公众号并回复 **666** 领取，更多内容陆续奉上。
